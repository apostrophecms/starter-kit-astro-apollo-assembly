---
import AposArea from '@apostrophecms/apostrophe-astro/components/AposArea.astro';
const { page, user, query } = Astro.props.aposData;
const { main } = page;
// Check if apos modules are exposed
console.log('apos exists:', !!Astro.props.aposData.apos);
console.log('modules exist:', !!Astro.props.aposData.apos?.modules);

// Check for the Stripe module specifically
if (Astro.props.aposData.apos?.modules) {
  const modules = Object.keys(Astro.props.aposData.apos.module);
  console.log('Available modules:', module.filter(m => m.includes('stripe')));
  console.log('Has stripe-payment:', !!Astro.props.aposData.apos.module['@bodonkey/stripe-payment']);
}

// More targeted logging to avoid too much output
console.log('aposData top-level keys:', Object.keys(Astro.props.aposData));
---
<section class="main-content astro-default-content">
  <AposArea area={main} />
</section>
<h2>Will this work at all?</h2>
 <button id="test-stripe-button">
    Test Stripe Integration
  </button>
</section>
<script>
  document.getElementById('test-stripe-button').addEventListener('click', async () => {
    console.log('Button clicked');
    
    try {
      const response = await fetch('http://localhost:3000/api/v1/@bodonkey/stripe-payment/create-stripe-checkout', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          productId: 'test-product',
          price: 29.99,
          name: 'Test Product',
          currency: 'usd'
        })
      });
      
      console.log('Response status:', response.status);
      const data = await response.json();
      console.log('Response data:', data);
      
      if (data.url) {
        window.location.href = data.url;
      } else {
        console.error('No checkout URL received:', data);
      }
    } catch (error) {
      console.error('Error:', error);
    }
  });
</script>

<style>
  .stripe-checkout-button {
    background: #635bff;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .stripe-checkout-button:hover {
    background: #5548e0;
    transform: translateY(-1px);
  }
</style>
